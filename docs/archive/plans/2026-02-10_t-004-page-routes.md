# T-004: Page Routes & Base Structure

**Status**: Complete
**Branch**: `feature/t-004-page-routes`
**Date**: 2026-02-10

---

## 1. Goal

Create all 6 page routes for CleanSpark, each fetching content from Content Collections and delegating to the ThemeResolver. Add a shared SEO/Head component with full metadata support.

## 2. Approach

**Architecture**: Semantic HTML Foundation with Progressive Enhancement

- Pages render semantic HTML sections styled with CSS custom properties
- Each section tagged with `data-section` attributes for surgical replacement in T-005+
- Each `<main>` tagged with `data-page` for theme-specific page styling
- SEO component lives in theme layouts (not pages), injected via BaseLayout's `<slot name="head" />`
- Pages fetch content, layouts handle presentation wrapper

**Alternatives considered**:

1. Minimal stub pages — too little value, no real content rendering
2. Full theme components now — premature, designs need T-005 theme specs
3. CSS-only themed sections — would duplicate layout logic in every page

## 3. Implementation

### Files Created (6)

- `src/components/shared/SEO.astro` — Open Graph, Twitter Cards, JSON-LD LocalBusiness, canonical URLs, theme-color meta
- `src/pages/services.astro` — Services grouped by category with cards, features, pricing
- `src/pages/about.astro` — Company story, values, team grid with certifications
- `src/pages/pricing.astro` — 3 pricing tiers with feature comparison + FAQ
- `src/pages/gallery.astro` — Before/after photo grid with client-side filter
- `src/pages/contact.astro` — Contact form + info cards + service areas

### Files Modified (8)

- `src/layouts/BaseLayout.astro` — Added `<slot name="head" />` with backwards-compatible fallback
- All 5 theme layouts — Added SEO component import, extended props (image, canonical, noindex)
- `src/pages/index.astro` — Replaced placeholder with featured services, testimonials, CTAs
- `docs/ARCHITECTURE.md` — Updated layout props interface documentation

### Build Results

- `astro check`: 0 errors, 0 warnings, 0 hints
- `pnpm build`: Complete (3.23s server build)
- 14 files changed, 1010 insertions, 29 deletions

## 4. Key Discoveries

- **BaseLayout named slots**: Astro supports `<slot name="head" />` inside `<head>` — enables theme layouts to inject SEO without prop drilling through BaseLayout
- **Astro auto-escapes content**: All Content Collection data rendered with `{expression}` syntax is automatically XSS-safe — no manual sanitization needed
- **`is:inline` directive**: Scripts with attributes (like `type="application/ld+json"`) need explicit `is:inline` in Astro to avoid processing warnings
- **`color-mix()` CSS function**: Used for semi-transparent borders/backgrounds from CSS custom properties without hardcoding alpha values

## 5. Future Improvements

1. **Extract common inline styles to utility module** — Repeated style strings (container, buttons, cards) across pages could be centralized in `src/lib/page-styles.ts`. Deferred because T-005+ theme components will replace all inline styles entirely.
2. **Add gallery filter URL state** — Current filter is client-side only (resets on navigation). Could persist filter in URL search params for shareable filtered views.
3. **Contact form API route** — Form currently shows client-side "Message Sent!" with no backend. Needs `/api/contact` endpoint (email service or serverless function).
4. **FAQ content extraction** — Pricing page FAQ is hardcoded in the template. Could be moved to a Content Collection if FAQ grows or becomes multi-page.

---

### Execution Log

#### 2026-02-10 — PHASE: Planning

- Goal: Create 6 page routes + SEO component for multi-theme site
- Approach: Semantic HTML with CSS custom properties, data-section attributes for T-005+ migration
- Risks: Inline style duplication (accepted — will be replaced by theme components)

#### 2026-02-10 — PHASE: Implementation

- Created SEO component with full metadata support
- Updated BaseLayout with head slot (backwards-compatible)
- Updated all 5 theme layouts with SEO integration
- Created 5 new pages + updated index with real content
- Fixed review findings: accessibility (role="img" for stars), form UX (reset + validation), redundant code

#### 2026-02-10 — PHASE: Complete

- Final approach: Semantic HTML foundation with data-section/data-page attributes
- Tests passing: Yes (astro check + build clean)
- User approval: Received
