# T-005: Minimal Zen Theme — Full Implementation

**Status**: Complete
**Created**: 2026-02-11
**Branch**: `feature/t-005-minimal-zen`
**Commit**: `6331bd4`

---

## 1. Goal

Implement the first complete theme (Minimal Zen) with navigation, footer, 6 page content components, scroll-reveal animations, and mobile responsive design. Establish the page-resolver pattern for future themes.

## 2. Approach

- Create `page-resolver.ts` as a static import map from (ThemeId, PageName) → page content component
- Build MinimalNav (sticky header, frosted glass, mobile hamburger overlay) and MinimalFooter
- Enhance MinimalLayout with nav, footer, scroll-reveal (IntersectionObserver)
- Create 6 page content components extracting presentation from page route files
- Refactor page routes to thin data-fetching shells using `resolvePageContent()`
- Install `@fontsource-variable/inter` for self-hosted variable font

## 3. Key Decisions

- **Page-resolver pattern**: Generic function `resolvePageContent<P extends PageName>()` narrows return type per page, enabling type-safe props. All unimplemented themes fall back to Minimal components.
- **Inline styles for mobile menu**: Astro scoped styles conflict with dynamically-toggled CSS classes in `<script>` blocks. Used inline styles via JS for reliable overlay visibility control instead of CSS class-based toggles.
- **Scroll-reveal as global styles**: `.reveal` / `.revealed` / `.reveal-stagger` patterns placed in `<style is:global>` in MinimalLayout since they're applied across multiple child components.
- **Theme switcher hidden on mobile**: Full theme dots overflow on small viewports; hidden via `:global(.theme-switcher)` in nav's scoped styles.

## 4. Implementation Summary

### Files Created

- `src/lib/page-resolver.ts` — Static (theme, page) → component resolver
- `src/components/minimal/MinimalNav.astro` — Sticky nav with frosted glass, mobile hamburger
- `src/components/minimal/MinimalFooter.astro` — Footer with nav, contact, social links
- `src/components/minimal/pages/MinimalHome.astro` — Hero, services grid, testimonials, CTA
- `src/components/minimal/pages/MinimalServices.astro` — Category-grouped service cards
- `src/components/minimal/pages/MinimalAbout.astro` — Story, team grid, values
- `src/components/minimal/pages/MinimalPricing.astro` — 3-tier comparison, FAQ
- `src/components/minimal/pages/MinimalGallery.astro` — Photo grid with category filter
- `src/components/minimal/pages/MinimalContact.astro` — Contact form, info cards, service areas

### Files Modified

- `src/layouts/minimal/MinimalLayout.astro` — Added nav, footer, scroll-reveal
- `src/pages/{index,services,about,pricing,gallery,contact}.astro` — Refactored to thin shells
- `CLAUDE.md` — Updated architecture, conventions, patterns sections
- `package.json` / `pnpm-lock.yaml` — Added @fontsource-variable/inter

### Stats

- 20 files changed, +2623 / -736 lines

## 5. Key Discoveries

- **Astro scoped styles + dynamic classes**: Astro's scoped CSS adds `[data-astro-cid-xxx]` to selectors. While this works for static markup, dynamically-toggled classes applied by `<script>` blocks can have unexpected specificity/cascade issues. Inline styles via JS are more reliable for JS-controlled visibility.
- **Scroll-reveal compound vs descendant selectors**: `.reveal-stagger.revealed > *` (compound) doesn't work when `.revealed` is on a parent — must use `.revealed .reveal-stagger > *` (descendant selector).
- **Generic type narrowing for resolvers**: Using `<P extends PageName>` with `as` cast enables TypeScript to narrow the return type per literal page name argument, avoiding union-type prop conflicts.

## 6. Future Improvements

1. **Astro scoped style investigation**: Research Astro's `:global()` pseudo-function for JS-toggled modifiers to find a CSS-only solution instead of inline styles
2. **Lighthouse audit**: Run Lighthouse on all 6 pages to verify 90+ scores (performance, accessibility, best practices, SEO)
3. **Shared button/form components**: Extract common `.btn`, `.field`, `.form` styles into shared utility components to reduce duplication across page components
4. **Contact form backend**: Currently client-side only; needs API endpoint or serverless function for actual form submission
5. **Image optimization**: Gallery and team photos use placeholder paths; integrate Astro `<Image>` with responsive sizes when real assets available

## 7. Execution Log

### 2026-02-11 — PHASE: Planning & Discovery

- Explored codebase: existing theme engine, content collections, page routes
- Identified page-resolver pattern for theme-specific content components
- Planned 6 Minimal page content components

### 2026-02-11 — PHASE: Implementation

- Installed @fontsource-variable/inter
- Created page-resolver.ts with generic type narrowing
- Created MinimalNav and MinimalFooter
- Updated MinimalLayout with nav, footer, scroll-reveal
- Created all 6 page content components
- Refactored all 6 page routes to thin shells
- Fixed TypeScript generic return type issue in resolvePageContent
- Build: 0 errors, 0 warnings, 0 hints

### 2026-02-11 — PHASE: Quality Review

- Code review found accessibility issues in nav, contact form, gallery, pricing
- Fixed: mobile menu focus management, tabindex control, Escape key handler
- Fixed: aria-pressed on gallery filter buttons
- Fixed: +/- indicators on pricing FAQ details elements
- Fixed: contact form button re-enable after 3 seconds

### 2026-02-11 — PHASE: Playwright Visual Testing

- Tested all pages at desktop (1280x800) and mobile (375x812) viewports
- Found and fixed: scroll-reveal stagger children invisible (compound vs descendant selector)
- Found and fixed: hamburger pushed off-screen by theme switcher dots on mobile
- Found and fixed: mobile menu overlay not showing (Astro scoped styles vs dynamic classes)
- All pages render correctly with proper content

### 2026-02-11 — PHASE: Complete

- Build: 0 errors, 0 warnings, 0 hints
- Committed as `6331bd4`
