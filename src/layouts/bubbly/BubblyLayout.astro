---
import '@fontsource/fredoka-one/400.css'
import '@fontsource/nunito/400.css'
import '@fontsource/nunito/700.css'
import '@fontsource/caveat/400.css'
import BaseLayout from '@layouts/BaseLayout.astro'
import SEO from '@components/shared/SEO.astro'
import BubblyNav from '@components/bubbly/BubblyNav.astro'
import BubblyFooter from '@components/bubbly/BubblyFooter.astro'
import { bubblyTheme } from '@themes/bubbly'
import { buildThemeCssVars } from '@lib/theme-css-vars'
import type { ThemeId } from '@themes/types'

interface Props {
  title?: string
  description?: string
  image?: string
  canonical?: string
  noindex?: boolean
  currentTheme?: ThemeId
}

const {
  title,
  description,
  image,
  canonical,
  noindex,
  currentTheme = Astro.locals.theme,
} = Astro.props
---

<BaseLayout>
  <SEO
    slot="head"
    title={title}
    description={description}
    image={image}
    canonical={canonical}
    noindex={noindex}
    theme={bubblyTheme}
  />
  <div data-theme={bubblyTheme.id} style={buildThemeCssVars(bubblyTheme)}>
    <BubblyNav currentTheme={currentTheme} />
    <slot />
    <BubblyFooter />
  </div>
</BaseLayout>

{/* Scroll-reveal: IntersectionObserver adds .revealed to .reveal elements */}
<script>
  function initBubblyScrollReveal(): void {
    const elements = document.querySelectorAll<HTMLElement>('.reveal')
    if (elements.length === 0) return

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add('revealed')
            observer.unobserve(entry.target)
          }
        })
      },
      { threshold: 0.1, rootMargin: '0px 0px -30px 0px' }
    )

    elements.forEach((el) => observer.observe(el))
  }

  initBubblyScrollReveal()
</script>

<style is:global>
  /* Scroll-reveal base â€” bubbly bounce-in feel */
  .reveal {
    opacity: 0;
    transform: translateY(30px);
    transition:
      opacity 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55),
      transform 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55);
  }

  .revealed {
    opacity: 1;
    transform: translateY(0);
  }

  /* Stagger children for grid reveals */
  .reveal-stagger > * {
    opacity: 0;
    transform: translateY(24px);
    transition:
      opacity 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55),
      transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
  }

  .revealed .reveal-stagger > * {
    opacity: 1;
    transform: translateY(0);
  }

  .revealed .reveal-stagger > *:nth-child(1) {
    transition-delay: 0ms;
  }
  .revealed .reveal-stagger > *:nth-child(2) {
    transition-delay: 100ms;
  }
  .revealed .reveal-stagger > *:nth-child(3) {
    transition-delay: 200ms;
  }
  .revealed .reveal-stagger > *:nth-child(4) {
    transition-delay: 300ms;
  }
  .revealed .reveal-stagger > *:nth-child(5) {
    transition-delay: 400ms;
  }
  .revealed .reveal-stagger > *:nth-child(6) {
    transition-delay: 500ms;
  }
</style>
