---
import '@fontsource/merriweather/400.css'
import '@fontsource/merriweather/700.css'
import '@fontsource/source-sans-3/400.css'
import '@fontsource/source-sans-3/600.css'
import BaseLayout from '@layouts/BaseLayout.astro'
import SEO from '@components/shared/SEO.astro'
import TrustNav from '@components/trust/TrustNav.astro'
import TrustFooter from '@components/trust/TrustFooter.astro'
import { trustTheme } from '@themes/trust'
import { buildThemeCssVars } from '@lib/theme-css-vars'
import type { ThemeId } from '@themes/types'

interface Props {
  title?: string
  description?: string
  image?: string
  canonical?: string
  noindex?: boolean
  currentTheme?: ThemeId
}

const {
  title,
  description,
  image,
  canonical,
  noindex,
  currentTheme = Astro.locals.theme,
} = Astro.props
---

<BaseLayout>
  <SEO
    slot="head"
    title={title}
    description={description}
    image={image}
    canonical={canonical}
    noindex={noindex}
    theme={trustTheme}
  />
  <div data-theme={trustTheme.id} style={buildThemeCssVars(trustTheme)}>
    <TrustNav currentTheme={currentTheme} />
    <slot />
    <TrustFooter />
  </div>
</BaseLayout>

{/* Scroll-reveal: IntersectionObserver adds .revealed to .reveal elements */}
<script>
  function initTrustScrollReveal(): void {
    const elements = document.querySelectorAll<HTMLElement>('.reveal')
    if (elements.length === 0) return

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add('revealed')
            observer.unobserve(entry.target)
          }
        })
      },
      { threshold: 0.08, rootMargin: '0px 0px -40px 0px' },
    )

    elements.forEach((el) => observer.observe(el))
  }

  initTrustScrollReveal()
</script>

<style is:global>
  /* Trust Shield scroll-reveal â€” minimal, professional fade-in */
  .reveal {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.5s ease, transform 0.5s ease;
  }

  .revealed {
    opacity: 1;
    transform: translateY(0);
  }

  /* Stagger children for grid reveals */
  .reveal-stagger > * {
    opacity: 0;
    transform: translateY(16px);
    transition: opacity 0.4s ease, transform 0.4s ease;
  }

  .revealed .reveal-stagger > * {
    opacity: 1;
    transform: translateY(0);
  }

  .revealed .reveal-stagger > *:nth-child(1) { transition-delay: 0ms; }
  .revealed .reveal-stagger > *:nth-child(2) { transition-delay: 80ms; }
  .revealed .reveal-stagger > *:nth-child(3) { transition-delay: 160ms; }
  .revealed .reveal-stagger > *:nth-child(4) { transition-delay: 240ms; }
  .revealed .reveal-stagger > *:nth-child(5) { transition-delay: 320ms; }
  .revealed .reveal-stagger > *:nth-child(6) { transition-delay: 400ms; }
</style>
