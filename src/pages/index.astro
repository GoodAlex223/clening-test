---
export const prerender = false

import { getCollection } from 'astro:content'
import { resolveLayout } from '@lib/theme-resolver'
import { resolvePageContent } from '@lib/page-resolver'
import { siteConfig } from '@lib/site-config'

const themeId = Astro.locals.theme
const Layout = resolveLayout(themeId)
const PageContent = resolvePageContent(themeId, 'home')

const allServices = await getCollection('services')
const featuredServices = allServices
  .filter((s) => s.data.featured)
  .sort((a, b) => a.data.displayOrder - b.data.displayOrder)
  .slice(0, 3)

const allTestimonials = await getCollection('testimonials')
const featuredTestimonials = allTestimonials
  .filter((t) => t.data.featured)
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
  .slice(0, 3)
---

<Layout description={siteConfig.seo.defaultDescription}>
  <PageContent services={featuredServices} testimonials={featuredTestimonials} />
</Layout>
